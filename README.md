Unity + ASP.NET LBA

Тестовое задание: «Coin Dash»
 
Кратко
Сделать простую мини-игру «вид сверху»: игроки бегают по небольшой арене и собирают монеты.
Клиент на Unity, сервер на ASP.NET (Minimal API) с одним HTTP-эндпоинтом и одним WebSocket-подключением. Сервер — авторитетный: рассылает тики состояния, спавнит монеты, считает очки. 
Сервер упакован в Docker.


Требования


1) Сервер
Функционал

Один HTTP-эндпоинт: 

POST /session

Вход: { "playerName": "..." }

Выход: { "sessionId": "<guid>" }

Одно WebSocket-подключение: GET /ws?sessionId=...

На подключение сервер:

Регистрирует игрока, присваивает стартовую позицию.

Отправляет текущее состояние матча (позиции игроков, монеты, счёт).

Каждые 100 мс сервер рассылает «тик состояния» всем подключённым (см. протокол ниже).

Сервер принимает вход игрока (направление движения).

Спавн монет каждые N секунд (например, 2–3 сек), количество монет ограничено (например, до 10).

Столкновение игрока с монетой засчитывается на сервере; счёт увеличивается на 1.

Heartbeat/проверка таймаута: если клиент не шлёт пинги/вход дольше 5 сек — дисконнект.

Примечания по реализации

Координаты — в условной сетке (например, 16×9), скорость ~5 ед/сек, простая физика/клип по границам.

Тики можно реализовать через System.Threading.Timer/HostedService.

Коллизии: расстояние до монеты < радиуса (например, 0.5).

Код стиля Minimal API + простой in-memory мир (без БД).

Логи — в консоль.

Docker:

Dockerfile c multi-stage build (SDK → runtime), порт 8080:


Dockerfile

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY . .
RUN dotnet publish -c Release -o /app
FROM mcr.microsoft.com/dotnet/aspnet:8.0
WORKDIR /app
COPY --from=build /app .
EXPOSE 8080
ENV ASPNETCORE_URLS=http://0.0.0.0:8080
ENTRYPOINT ["dotnet","Server.dll"]
 



2) Клиент (Unity 2021+)
Функционал

Экран ввода имени, кнопка «Play»:

POST /session → получить sessionId;

Подключиться к wsUrl по сокету.

Игровой экран:

Простая арена (plane или tilemap), топ-даун камера.

Игрок управляется WASD/аналог стика — клиент шлёт вход на сервер, позицию рендерит по состоянию из тиков (интерполяция между тик-снимками приветствуется, но не обязательна).

Монеты — примитивные спрайты/mesh; при сборе исчезают после события coin_collected.

Табло очков/лидерборд (топ-3).

Индикатор пинга (на основе ping/pong).

Обработка разрыва связи (UI баннер) с попыткой переподключения по кнопке.

 

Транспорт

HTTP: UnityWebRequest

WS: любой доступный клиент (например, ClientWebSocket через .NET 4.x runtime в Unity или сторонняя либрари без внешних сервисов)

-----------------------------------------------------------------------------------------------------
Это моё тестовое задание, потратил пару дней "размазанные" на неделю, в свободное время. 

Unity часть:  

Unity 2022.3.57f1

Сцена - PrototypeFolder/Scenes/Game

Главная директория -  PrototypeFolder.
В ней находится всё, что связано с данным проектом.

Использовал Zenject, UniRx, логику реализовал сервисами.
 
ServerConnectionService - Отвечает за подключение к серверу и начало сессии.

WebSocketConnectionService - За обмен данными с сервером и распределение новых данных в другие сервисы.

SpawnSlimeService - Этот сервис убирает лишних игроков (в моем случае я выбрал слаймов), так же в нем есть логика для Header'ов.

UpdateSlimeService - Сервис обновления позиции для слаймов и Header'ов. Все Header'ы находятся в одном Canvas для оптимизации отрисовки.

UpdateCoinService - Обновляет монетки, спавнит новые и убирает лишние, если такие есть.

GameView - Вход в игру + Score игрока (правый верхний угол) + список из 3 лучших на текущий момент (левый верхний угол).

MyGameInstaller - DI, пулы для слаймов, Header'ов и монет, сервисы и тд.

Так же реализовал Joystick через UIToolkit. Включить управление можно либо собрав проект под Android/iOS или изменить значение _inputSystem в WebSocketConnectionService с Auto на необходимое.

Сделал отключение игрока через определенный интервал. Сделал его больше, для удобного тестирования. 

 
Игровой процесс:

Вход в игру - ввод имени и нажать кнопку "Connect". Управление WASD либо джойстик. Подбор монет происходит лишь когда ты полностью в нее входишь. Меняется значение счетчика в правом углу и если ты в топ-3 - то в лидерборде слева.

.Net часть:

Реализован сервис WebSocketService, который обновляет данные для всех игроков, которые подключены.
Так же WebSocketHandler - для получения команд перемещения от игроков.
Сделал быстро, опыта большого не имею с серверной частью. 

Для Docker использовал эти команды:

docker build -t coindashbackend-server .

dotnet publish -c Release

docker compose up --build

Если будут проблемы, то можно использовать
docker init
